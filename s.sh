#!/bin/bash

# Проверяем, что был передан один аргумент
if [ $# -ne 1 ]; then
    echo "Использование: $0 адрес_сервера"
    exit 1
fi

# Сохраняем адрес сервера в переменную
server=$1

# Создаем меню
PS3='Выберите опцию: '
options=("Показать список всех словарей" "По какому словарю выдать информацию" "Вывести список команд" "Вывести список стратегий поиска" "Что вас интересует, определение слова (фразы) или поиск по шаблону" "Выход")
select opt in "${options[@]}"
    do
    case $opt in
    1)
        echo "Показать список всех словарей"
        # Отправляем запрос к серверу и выводим список словарей
        curl -s "$server" | awk '/^dicts/ {print $2}'
        ;;
    2)
        echo "По какому словарю выдать информацию"
        # Выводим список всех словарей
        curl -s "$server" | awk '/^dicts/ {print $2}'

        # Запрашиваем у пользователя выбор словаря
        read -p "Введите номер словаря: " dict_num

        # Проверяем, что пользователь ввел число
        if ! [[ $dict_num =~ ^[0-9]+$ ]]; then
            echo "Некорректный ввод. Введите число."
            continue
        fi

        # Отправляем запрос к серверу и выводим информацию о выбранном словаре
        curl -s "$server/$dict_num"
        ;;
    3)
        echo "Вывести список команд"
        # Отправляем запрос к серверу и выводим список команд
        curl -s "$server/commands"
        ;;
    4)
        echo "Вывести список стратегий поиска"
        # Отправляем запрос к серверу и выводим список стратегий поиска
        curl -s "$server/search_strategies"
        ;;
    5)
        echo "Что вас интересует, определение слова (фразы) или поиск по шаблону"
        read -p "Введите 1 для определения слова (фразы) или 2 для поиска по шаблону: " choice

        if [ $choice -eq 1 ]; then
            # Запрашиваем у пользователя выбор типа словаря
            read -p "Введите а для толковых словарей, э для энциклопедических или п для переводных: " dict_type

            case $dict_type in
            "а")
                # Выводим список толковых словарей
                curl -s "$server/dicts" | awk '/^dicts/ {print $2}' | grep -E 'толковый|словарь'
                ;;
            "э")
                # Выводим список энциклопедических словарей
                curl -s "$server/dicts" | awk '/^dicts/ {print $2}' | grep -E 'энциклопедический|словарь'
                ;;
            "п")
                # Выводим список переводных словарей
                curl -s "$server/dicts" | awk '/^dicts/ {print $2}' | grep -E 'переводный|словарь'
                ;;
            *)
                echo "Некорректный ввод. Введите а для толковых словарей, э для энциклопедических или п для переводных."
                continue
                ;;
            esac
                
            # Запрашиваем у пользователя выбор словаря
            read -p "Введите словарь: " dict_num

            # Запрашиваем у пользователя ввод слова или фразы
            read -p "Введите слово или фразу для поиска: " word

            # Отправляем запрос к серверу и выводим определение слова или фразы
            curl -s "$server/$dict_num/$word"
        fi
        if [ $choice -eq 2 ]; then
            # Запрашиваем у пользователя ввод шаблонной строки
            read -p "Введите шаблонную строку для поиска: " pattern

            # Отправляем запрос к серверу и выводим результаты поиска
            curl -s "$server/search?pattern=$pattern"
        fi
        ;;
    *)
        echo "Некорректный ввод. Выберите опцию из списка."
        continue
        ;;
    0)
        break
        ;;
    esac
done